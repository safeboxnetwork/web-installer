<!doctype html>
<html lang="en">
<head>
<!-- Required meta tags -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>INSTALLER TOOL</title>
<!-- Bootstrap CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.2.1/dist/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
<!-- Custom styles for this template -->
<link href="installer.css?t=3" rel="stylesheet">
</head>
<body id="manage" class="text-center">
<div class="container-fluid">
<div class="col-md-12">

<h1>Found deployed envinronment</h1>

<div style="text-align:right">
	<a href="javascript:void()" id="settings_btn">SETTINGS</a>
</div>

<fieldset id="settings" class="hidden">
<legend>Settings</legend>
<div id="repositories" style="text-align:left">Loading...</div>

<form class="form-install" action="#" method="post">
<div class="row">
    <div class="mb-3">
	<label for="registry">Please add a new repository name:</label>
	<input type="registry" class="form-control" name="repository" id="repository" value="" required>
	<div class="invalid-feedback">
	Please enter a valid repository name.
	</div>
    </div>
</div>
<div class="row">
    <div class="mb-3">
	<button class="btn btn-lg btn-primary btn-block" type="button"> Send </button>
    </div>
</div>
</form>
</fieldset>

<fieldset>
<legend>Deployments</legend>
<div id="deployments" style="text-align:left">Loading...</div>
</fieldset>

<fieldset>
<legend>Running services</legend>
<pre><div id="running" style="text-align:left">Loading...</div></pre>
</fieldset>

<fieldset>
<legend>Disk management</legend>
</fieldset>

<fieldset>
<legend>Monitor</legend>
</fieldset>

</div>
</div>
<br>
<br>
<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.6/dist/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.2.1/dist/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>
<script>

function check_repositories() {
  var url  = 'scan.php?op=check_repositories';
  jQuery.get(url, function(data) {
      if (data!="") {
	      jQuery("#repositories").html(data);
      }
      else setTimeout(check_repositories, 500);
  });
}

function get_repositories() {
  var url  = 'scan.php?op=repositories';
  jQuery.get(url, function(data) {
	  if (data=="OK") {
      		setTimeout(check_repositories, 500);
	  }
  });
}

function check_system() {
  var url  = 'scan.php?op=check_system&services=1';
  jQuery.get(url, function(data) {
      if (data!="") {
	      jQuery("#system").html(data);
      }
      else setTimeout(check_system, 500);
  });
}

function get_system() {
  var url  = 'scan.php?op=system';
  jQuery.get(url, function(data) {
	  if (data=="OK") {
      		setTimeout(check_system, 500);
	  }
  });
}

function check_deployments() {
  var url  = 'scan.php?op=check_deployments&services=1';
  jQuery.get(url, function(data) {
      if (data!="") {
	      jQuery("#deployments").html(data);
      }
      else setTimeout(check_deployments, 500);
  });
}

function get_deployments() {
  var url  = 'scan.php?op=deployments';
  jQuery.get(url, function(data) {
	  if (data=="OK") {
      		setTimeout(check_deployments, 500);
	  }
  });
}
function check_containers() {
  var url  = 'scan.php?op=check_containers';
  jQuery.get(url, function(data) {
      if (data!="") {
	      jQuery("#running").html(data);
      }
      else setTimeout(check_containers, 1000);
  });
}

function get_containers() {
  var url  = 'scan.php?op=containers';
  jQuery.get(url, function(data) {
	  if (data=="OK") {
      		setTimeout(check_containers, 1000);
	  }
  });
}

jQuery(document).ready(function(){

	get_repositories();
	get_deployments();
	get_containers();

	jQuery('#settings_btn').click(function() {
		jQuery('#settings').toggle();
	});

	jQuery('select#smarthost').click(function() {
		if (jQuery(this).val()=='yes') jQuery('#div_smarthost').show();
		else jQuery('#div_smarthost').hide();

		if (jQuery("#smarthost").val()=='no' && jQuery("#localproxy").val()=='yes') {
			alert("Warning! Local proxy will not work without smarthost proxy service.");
		}
	});
	jQuery('select#vpn').click(function() {
		if (jQuery(this).val()=='yes') jQuery('#div_vpn').show();
		else jQuery('#div_vpn').hide();
	});
/*
	jQuery('select#discovery').click(function() {
		if (jQuery(this).val()=='yes') jQuery('#div_discover').show();
		else jQuery('#div_discover').hide();
	});
	jQuery('select#additionals').click(function() {
		if (jQuery(this).val()=='yes') jQuery('#div_additionals').show();
		else jQuery('#div_additionals').hide();
	});
	jQuery('select#nextcloud').click(function() {
		if (jQuery(this).val()=='Y') jQuery('#div_nextcloud').show();
		else jQuery('#div_nextcloud').hide();
	});
	jQuery('select#bitwarden').click(function() {
		if (jQuery(this).val()=='Y') jQuery('#div_bitwarden').show();
		else jQuery('#div_bitwarden').hide();
	});
	jQuery('select#bitwarden_smtp').click(function() {
		if (jQuery(this).val()=='3') jQuery('#div_bitwarden_smtp').show();
		else jQuery('#div_bitwarden_smtp').hide();
	});
	jQuery('select#guacamole').click(function() {
		if (jQuery(this).val()=='Y') jQuery('#div_guacamole').show();
		else jQuery('#div_guacamole').hide();
	});
	jQuery('select#smtp_server').click(function() {
		if (jQuery(this).val()=='Y') jQuery('#div_smtp_server').show();
		else jQuery('#div_smtp_server').hide();
	});
	jQuery('select#roundcube').click(function() {
		if (jQuery(this).val()=='Y') jQuery('#div_roundcube').show();
		else jQuery('#div_roundcube').hide();
	});
*/
});
</script>
</body>
</html>
